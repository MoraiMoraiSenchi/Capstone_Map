<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capstone</title>
    <meta charset="utf-8">
    <script src="chart.js\dist\Chart.js"></script> <!-- 오각형 그래프에 사용할 js파일-->
    <script src = "place_copy.js"></script> <!-- 키워드 검색하는 js파일-->
    <script src = "circle.js"></script> <!-- 원 나타내는 js파일-->
    <script src = "bus_cctv.js"></script> <!-- 버스 정류장/CCTV 개수 세는 js파일-->
    <script src = "score.js"></script> <!-- 점수 내는 js 파일-->
    <script src = "buttonclick.js"></script> <!-- 버튼 클릭 함수-->
    <script src = "BUSSTOP_INFO.json"></script> <!-- 버스 정류장 json 데이터-->
    <script src = "CCTV_INFO.json"></script> <!-- CCTV json 데이터-->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=368cbd36dadbf4ad8c1a657b33af0907&libraries=services"></script>
    <link href="style.css", rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@500&display=swap" rel="stylesheet">
</head>
<body>
    <div id="map"></div>
    <div id="clickLatlng"></div>
    <div id="containerBox">
        <div id="chartContainer">
            <canvas id="myChart"></canvas>
        </div>
        <div id="scoreContainer">
            <div class="scoreIndex">
                <button onclick = "Con_Click(BtnCon)">편의성</button>
                <div id="Con" class="scoreBox"></div>
            </div>
            <div class="scoreIndex">
                <button onclick = "Safety_Click(bus_cctv_Array, BtnSafety)">안전</button>
                <div id="Safety" class="scoreBox"></div>
            </div>
            <div class="scoreIndex">
                <button onclick = "Res_Click(BtnRes)">먹거리</button>
                <div id="Res" class="scoreBox"></div>
            </div>
            <div class="scoreIndex">
                <button onclick = "Tra_Click(bus_cctv_Array)">교통성</button>
                <div id="Tra" class="scoreBox"></div>
            </div>
            <div class="scoreIndex">
                <button onclick = "Play_Click(BtnPlay)">놀거리</button>
                <div id="Play" class="scoreBox"></div>
            </div>
        </div>
        <div id="infobox">
            <p id = "info_p"></p>
            <p id = "count_p"></p>
        </div>
        <img src="logo.png" id="logo"/>
    </div>
    <script>
        BUS_STATION_CCTV_INFO_INIT();

        var im = document.getElementById("logo");
        var bg = document.getElementById("containerBox")

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(35.17690999613079, 126.90610797027583), // 지도의 중심좌표
                level: 5 // 지도의 확대 레벨
            };
        var BtnCon, BtnSafety, BtnRes, BtnPlay;
        
        //var Con = 0, Safety = 0, Res = 0, Tra = 0, Play = 0; // 그래프에 사용할 변수 - indexl.html에서 안 쓰므로 삭제 예정
        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

        var bus_cctv_Array = new Array(); // 버스와 cctv 정보 저장할 배열

        let myChart = document.getElementById('myChart').getContext('2d'); // 오각형 그래프 생성

        let radarChart = new Chart(myChart, {
            type: 'radar',
            data: {
                labels: ['편의', '안전', '먹거리', '교통성', '놀거리'],
                datasets: 
                [{
                    label: '점수',
                    data: [0, 0, 0, 0, 0],
                    pointStyle: 'star',
                    backgroundColor : 'rgba(168, 100, 255, 0.3)'
                }]
            },
            options: 
            {
                layout:{
                    padding : {left : 0, right :-200, top : 0, bottom: 0},
                },
                scale: 
                {
                    ticks: {max : 5, min : 0, stepSize : 1, fontSize : 15, fontFamily : "'Noto Serif KR', serif"},
                    pointLabels : { fontSize : 12, fontStyle : 'bald', fontFamily : "'Noto Serif KR', serif"}
                },
                legend: { display:false }
            }
        });

        make_Circle(map); // 지도에 원을 표시합니다

        kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
            var r = Math.random()*255, g = Math.random()*255, b = Math.random()*10;

            var latlng = mouseEvent.latLng;   // 클릭한 위도, 경도 정보를 가져옵니다

            im.animate({
                transform: ['rotate(0deg)', 'rotate(360deg)', 'rotate(0deg)'],
                easing : [ 'ease-in', 'ease-out', 'ease-in']
            }, 1500);
            bg.animate([
                    { backgroundColor: "rgba(" + r.toFixed(0) + "," + g.toFixed(0) + ",0 "   + "," + "0.08)"}],
                    { duration : 500, fill : "forwards"}
                ); // 전남대 로고, 배경 애니메이션

            draw_Circle(latlng); // 100/200/500 반경 원 생성

            bus_cctv_Array = count_BUSSTOP_CCTV(latlng.getLat(), latlng.getLng());
            Tra = TRA_score(bus_cctv_Array);
            Safety = SAFETY_score(bus_cctv_Array);     
            
            updateChart(latlng, radarChart, Tra, Safety, function(C, S, R, P)
            {
                BtnCon = C;
                BtnSafety = S;
                BtnRes = R;
                BtnPlay = P;
            });
    });
    </script>
</body>
</html>
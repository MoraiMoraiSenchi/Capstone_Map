<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capstone</title>
    <meta charset="utf-8">
    <script src="chart.js\dist\Chart.js"></script> <!-- 오각형 그래프에 사용할 js파일-->
    <script src = "place.js"></script> <!-- 키워드 검색하는 js파일-->
    <script src = "circle.js"></script> <!-- 원 나타내는 js파일-->
    <script src = "bus_cctv.js"></script> <!-- 버스 정류장/CCTV 개수 세는 js파일-->
    <script src = "score.js"></script> <!-- 점수 내는 js 파일-->
    <script src = "BUSSTOP_INFO.json"></script> <!-- 버스 정류장 json 데이터-->
    <script src = "CCTV_INFO.json"></script> <!-- CCTV json 데이터-->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=368cbd36dadbf4ad8c1a657b33af0907&libraries=services"></script>
    <link href="style.css", rel="stylesheet">
</head>
<body>
    <div id="map"></div>
    <div id="clickLatlng"></div>
    <div id="chartContainer">
        <canvas id="myChart"></canvas>
    </div>
    <script>
        BUS_STATION_CCTV_INFO_INIT();
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(35.17690999613079, 126.90610797027583), // 지도의 중심좌표
                level: 5 // 지도의 확대 레벨
            };
        
        var Con = 0, Safety = 0, Res = 0, Tra = 0, Play = 0; // 그래프에 사용할 변수
        var clicked_position = new kakao.maps.LatLng(0,0); // 클릭한 위치
        var i = 0;
        var bus_cctv_Array = new Array(); // 각 함수들의 리턴값 저장할 배열

        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

        let myChart = document.getElementById('myChart').getContext('2d');

        let radarChart = new Chart(myChart, {
            type: 'radar',
            data: {
                labels: ['편의', '안전', '먹거리', '교통성', '놀거리'],
                datasets: 
                [{
                    label: '점수',
                    data: [Con, Safety, Res, Tra, Play],
                    pointStyle: 'star',
                    backgroundColor : 'rgba(168, 100, 255, 0.3)'
                }]
            },
            options: 
            {
                scale: 
                {
                    ticks: {max : 5, min : 0, stepSize : 1},
                    pointLabels : { fontSize : 13, fontStyle : 'bold'}
                }
            }
        });

        make_Circle(map); // 지도에 원을 표시합니다

        // 지도에 클릭 이벤트를 등록합니다
        // 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
        
        kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
            var latlng = mouseEvent.latLng;   // 클릭한 위도, 경도 정보를 가져옵니다
            clicked_position = latlng // 클릭한 위치에 위도 경도 대입

            draw_Circle(latlng); // 100/200/500 반경 원 생성

            bus_cctv_Array = count_BUSSTOP_CCTV(latlng.getLat(), latlng.getLng());

            Tra = TRA_score(bus_cctv_Array);
            Safety = SAFETY_score(bus_cctv_Array);
            
            findRes(latlng,function(x){
                Res = x;
                findCon(latlng,function(x){Con = x;});
                findPlay(latlng,function(x){Play = x;});
                findBar(latlng,function(x){
                Safety -= x
                if(Safety < 0) Safety = 0;
                update(radarChart, [Con, Safety, Res, Tra, Play]);
                //console.log(Con, Safety, Res, Tra, Play);
            });
            //setTimeout(function(){update(radarChart, [Con, Safety, Res, Tra, Play])}, 1000);
            //  // 오각형 그래프 표현하는 함수
        });
    });
    </script>
</body>
</html>